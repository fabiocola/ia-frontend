<!DOCTYPE html>
<html lang="pt-BR" :class="theme">
<head>
    <!-- HEAD igual ao anterior + PWA -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#007bff">
    <title>Orquestrador Pro - IA Colaborativa</title>
    <!-- CSS anterior + auth modal styles -->
</head>
<body>
    <!-- ðŸ” AUTH MODAL (NOVO) -->
    <div v-if="!isAuthenticated" class="auth-overlay" role="dialog" aria-modal="true">
        <div class="auth-card">
            <h2>{{ authMode === 'login' ? 'Login' : 'Cadastre-se GrÃ¡tis' }}</h2>
            <form @submit.prevent="authMode === 'login' ? doLogin() : doRegister()">
                <input v-show="authMode !== 'login'" v-model="authForm.name" placeholder="Nome completo" required>
                <input v-model="authForm.email" type="email" placeholder="Email" required>
                <input v-model="authForm.password" type="password" placeholder="Senha (min 6)" required minlength="6">
                <button type="submit" :disabled="loading">
                    {{ loading ? 'Carregando...' : (authMode === 'login' ? 'Entrar' : 'Criar Conta') }}
                </button>
            </form>
            <p class="toggle-auth" @click="toggleAuthMode">
                {{ authMode === 'login' ? 'Criar conta gratuita' : 'JÃ¡ tenho conta' }}
            </p>
            
            <!-- PLANOS TEASER -->
            <div class="plans-preview">
                <div class="plan pro">
                    <h4>ðŸš€ Pro R$97/mÃªs</h4>
                    <ul>
                        <li>âœ… Uso ilimitado</li>
                        <li>âœ… Armazenamento 10GB</li>
                        <li>âœ… Docs prioritÃ¡rios</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- APP PRINCIPAL (condicional) -->
    <div v-else id="app">
        <!-- Sidebar + Main igual ao anterior -->
        <!-- Com botÃ£o user profile -->
        <div class="user-profile" @click="logout">
            {{ user.name }} ({{ user.plan }}) â–¼
        </div>
    </div>

<script>
// Vue data + auth
data() {
    return {
        isAuthenticated: false,
        token: null,
        user: null,
        authMode: 'register',  // ComeÃ§a com register
        authForm: { name: '', email: '', password: '' },
        loading: false,
        // ... resto dos dados
    };
},
async mounted() {
    await this.initAuth();
    if (this.isAuthenticated) this.loadChatHistory();
},
methods: {
    async initAuth() {
        this.token = localStorage.getItem('token');
        if (this.token) {
            try {
                const res = await fetch('/auth/me', {
                    headers: { Authorization: `Bearer ${this.token}` }
                });
                if (res.ok) {
                    this.user = await res.json();
                    this.isAuthenticated = true;
                } else {
                    localStorage.removeItem('token');
                }
            } catch {
                localStorage.removeItem('token');
            }
        }
    },
    async doRegister() {
        this.loading = true;
        try {
            const form = new FormData();
            form.append('full_name', this.authForm.name);
            form.append('email', this.authForm.email);
            form.append('password', this.authForm.password);
            
            const res = await fetch('/auth/register', {
                method: 'POST',
                body: form
            });
            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('token', data.access_token);
                this.isAuthenticated = true;
                this.user = data.user;
                await this.loadChatHistory();
            }
        } catch (e) {
            alert('Erro no cadastro');
        }
        this.loading = false;
    },
    async doLogin() {
        // Similar ao register, mas /auth/login
    },
    logout() {
        localStorage.removeItem('token');
        this.isAuthenticated = false;
        this.user = null;
    },
    // Resto methods com Authorization header
    async sendMessage() {
        const headers = {
            'Authorization': `Bearer ${this.token}`,
            'Content-Type': 'application/x-www-form-urlencoded'
        };
        // ... resto igual
    }
}
</script>
